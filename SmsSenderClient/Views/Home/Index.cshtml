@model MessageViewModel
@{
    ViewData["Title"] = "Send Message";
    var messageSent = TempData["MessageSent"] as bool? ?? false;
}

<div class="min-h-screen flex items-center justify-center bg-slate-50 px-4 pb-12">
    <div class="w-full max-w-md">
        <h1 class="text-2xl font-semibold tracking-tight mb-4 text-center">Send us a message</h1>

        <form asp-controller="Message"
              asp-action="SendMessage"
              method="post"
              class="space-y-4 bg-white/70 backdrop-blur rounded-xl p-4 shadow-sm"
              novalidate>
            @Html.AntiForgeryToken()

            <div asp-validation-summary="ModelOnly" class="text-red-600 text-sm"></div>

            <div class="flex flex-col">
                <label asp-for="Name" class="mb-1 text-sm font-medium">Your name (optional)</label>
                <input asp-for="Name"
                       type="text"
                       autocomplete="name"
                       class="w-full rounded-lg border border-slate-300 px-3 py-2 text-base focus:outline-none focus:ring-2 focus:ring-sky-500 focus:border-sky-500"
                       placeholder="Jane Doe" />
                <span asp-validation-for="Name" class="text-red-600 text-xs mt-1"></span>
            </div>

            <div class="flex flex-col">
                <label asp-for="Message" class="mb-1 text-sm font-medium">Message <span class="text-red-500">*</span></label>
                <textarea asp-for="Message"
                          rows="6"
                          maxlength="500"
                          class="w-full resize-y rounded-lg border border-slate-300 px-3 py-2 text-base leading-relaxed focus:outline-none focus:ring-2 focus:ring-sky-500 focus:border-sky-500"
                          placeholder="Type your message…"></textarea>
                <div class="flex items-center justify-between mt-1">
                    <span asp-validation-for="Message" class="text-red-600 text-xs"></span>
                    <span id="msgCounter" class="text-xs text-slate-500">0 / 500</span>
                </div>
            </div>

            <button type="submit"
                    class="w-full rounded-lg bg-sky-600 px-4 py-2.5 text-white font-medium active:scale-[0.99] hover:bg-sky-700 focus:outline-none focus:ring-2 focus:ring-sky-500">
                Send
            </button>
        </form>
    </div>
</div>



@if (messageSent)
{
    <div id="sentModal"
         class="fixed inset-0 z-50 flex items-center justify-center px-4"
         role="dialog" aria-modal="true" aria-labelledby="sentTitle">

        <div class="absolute inset-0 bg-black/40" aria-hidden="true"></div>

        <div class="relative w-full max-w-sm rounded-2xl bg-white p-6 shadow-lg">
            <div class="flex items-start gap-3">

                <div class="shrink-0 mt-0.5">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
                         class="h-8 w-8">
                        <circle cx="12" cy="12" r="10" class="fill-emerald-100"></circle>
                        <path d="M8.5 12.5l2.5 2.5 4.5-5.5"
                              class="stroke-emerald-600" stroke-width="2" fill="none"
                              stroke-linecap="round" stroke-linejoin="round"></path>
                    </svg>
                </div>

                <div class="flex-1">
                    <h2 id="sentTitle" class="text-base font-semibold">
                        Message sent successfully
                    </h2>
                    <p class="mt-1 text-sm text-slate-600">
                        Thank you! We’ll get back to you soon.
                    </p>
                </div>

                <button type="button" id="sentCloseBtn"
                        class="ml-2 rounded-md p-1 text-slate-500 hover:bg-slate-100 focus:outline-none focus:ring-2 focus:ring-sky-500"
                        aria-label="Close">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5"
                         viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd"
                              d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 
                                 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 
                                 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 
                                 10 4.293 5.707a1 1 0 010-1.414z"
                              clip-rule="evenodd" />
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <script>
        (function () {
            const modal = document.getElementById('sentModal');
            const closeBtn = document.getElementById('sentCloseBtn');

            const close = () => {
                if (!modal) return;
                modal.style.opacity = '0';
                modal.style.pointerEvents = 'none';
                setTimeout(() => modal.remove(), 5000);
            };

            setTimeout(close, 5000);

            closeBtn?.addEventListener('click', close);

            modal?.addEventListener('click', (e) => {
                if (e.target === modal) close();
            });

            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') close();
            });
        })();
    </script>
}

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        (function () {
            const ta = document.querySelector('textarea[name="Message"]');
            const counter = document.getElementById('msgCounter');
            if (!ta || !counter) return;

            const update = () => {
                const len = ta.value.length || 0;
                counter.textContent = `${len} / 500`;
            };

            ta.addEventListener('input', update, { passive: true });
            update();
        })();
    </script>
}
